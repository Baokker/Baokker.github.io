

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="https://baokker-oss-blog-hangzhou.oss-cn-hangzhou.aliyuncs.com/cdn_for_blog/blog_default_imgs/favicon.png">
  <link rel="icon" href="https://baokker-oss-blog-hangzhou.oss-cn-hangzhou.aliyuncs.com/cdn_for_blog/blog_default_imgs/favicon.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Baokker">
  <meta name="keywords" content="">
  
    <meta name="description" content="终于肝完了！">
<meta property="og:type" content="article">
<meta property="og:title" content="前端漫谈——数据库课设心得记录">
<meta property="og:url" content="http://baokker.github.io/2022/09/04/%E5%89%8D%E7%AB%AF%E6%BC%AB%E8%B0%88%E2%80%94%E2%80%94%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BE%E8%AE%BE%E5%BF%83%E5%BE%97%E8%AE%B0%E5%BD%95/index.html">
<meta property="og:site_name" content="Baokker&#39;s Blog">
<meta property="og:description" content="终于肝完了！">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://baokker-oss-blog-hangzhou.oss-cn-hangzhou.aliyuncs.com/cdn_for_blog/blog_default_imgs/defaultImages.jpg">
<meta property="article:published_time" content="2022-09-04T10:24:48.000Z">
<meta property="article:modified_time" content="2022-10-08T12:53:57.255Z">
<meta property="article:author" content="Baokker">
<meta property="article:tag" content="数据库课设">
<meta property="article:tag" content="前端">
<meta property="article:tag" content="vue">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://baokker-oss-blog-hangzhou.oss-cn-hangzhou.aliyuncs.com/cdn_for_blog/blog_default_imgs/defaultImages.jpg">
  
  
  
  <title>前端漫谈——数据库课设心得记录 - Baokker&#39;s Blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"baokker.github.io","root":"/","version":"1.9.0","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>

  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Baokker&#39;s Blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                友链
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('https://baokker-oss-blog-hangzhou.oss-cn-hangzhou.aliyuncs.com/cdn_for_blog/blog_default_imgs/defaultImages.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="前端漫谈——数据库课设心得记录"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2022-09-04 18:24" pubdate>
          2022年9月4日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          28k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          235 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">前端漫谈——数据库课设心得记录</h1>
            
            <div class="markdown-body">
              
              <p>项目源码：<a target="_blank" rel="noopener" href="https://github.com/Baokker/covid_manage_db_system">https://github.com/Baokker/covid_manage_db_system</a></p>
<h1 id="IDE"><a href="#IDE" class="headerlink" title="IDE"></a>IDE</h1><p>IDE采用的还是VS Code，不论是本地开发还是用code server处理放在服务器上的代码，用起来都比较顺手。比较好用的一些tips：</p>
<ul>
<li><p>左侧的源代码管理，可以方便地查看代码作出的更改，以及合并时需要手动解决的冲突<br><img src="https://baokker-oss-blog-hangzhou.oss-cn-hangzhou.aliyuncs.com/cdn_for_blog/blog_imgs/image-20220904220903064.png" srcset="/img/loading.gif" lazyload alt="image-20220904220903064"></p>
</li>
<li><p>Tabnine人工智能补全代码。仅仅是单行tab补全的free功能，也为我减少了不少工作量（缺点：只能本地弄，服务器吃不消这么大内存~）<br><img src="https://baokker-oss-blog-hangzhou.oss-cn-hangzhou.aliyuncs.com/cdn_for_blog/blog_imgs/image-20220904221024374.png" srcset="/img/loading.gif" lazyload alt="image-20220904221024374"><br><img src="https://baokker-oss-blog-hangzhou.oss-cn-hangzhou.aliyuncs.com/cdn_for_blog/blog_imgs/image-20220904221111200.png" srcset="/img/loading.gif" lazyload alt="image-20220904221111200"></p>
</li>
<li><p>彩虹括号配对，当代码没对齐时，可以较快定位到错误位置：<br><img src="https://baokker-oss-blog-hangzhou.oss-cn-hangzhou.aliyuncs.com/cdn_for_blog/blog_imgs/image-20220904221156131.png" srcset="/img/loading.gif" lazyload alt="image-20220904221156131"><br>开启方法：在Visual Studio Code 1.61中已经将Bracket pair guides内置到软件中。<code>ctrl+,</code>打开设置，搜索<code>editor.bracketPairColorization.enabled</code>并设为<code>true</code><br><img src="https://baokker-oss-blog-hangzhou.oss-cn-hangzhou.aliyuncs.com/cdn_for_blog/blog_imgs/image-20220904221713218.png" srcset="/img/loading.gif" lazyload alt="image-20220904221713218"></p>
</li>
<li><p>auto close tag插件<br><img src="https://baokker-oss-blog-hangzhou.oss-cn-hangzhou.aliyuncs.com/cdn_for_blog/blog_imgs/image-20220904221952357.png" srcset="/img/loading.gif" lazyload alt="image-20220904221952357"></p>
</li>
<li><p>Babel JavaScript插件</p>
</li>
<li><p>Vetur（vue官方为vscode提供的插件，对我来说最大的作用在于格式化代码）（同样的功能，再推荐一个Prettier插件，支持语言种类更多）<br><img src="https://baokker-oss-blog-hangzhou.oss-cn-hangzhou.aliyuncs.com/cdn_for_blog/blog_imgs/image-20220904222547974.png" srcset="/img/loading.gif" lazyload alt="image-20220904222547974"></p>
</li>
</ul>
<h1 id="碎片化"><a href="#碎片化" class="headerlink" title="碎片化"></a>碎片化</h1><p>学习前端给我的最大感受是：碎片化</p>
<ul>
<li><p>在开始学习Vue2之前，首先需要对</p>
<ul>
<li>HTML</li>
<li>css</li>
<li>JavaScript</li>
</ul>
<p>有一个基本的了解，最好能有初步构建网页的能力</p>
</li>
<li><p>接下来就需要对Vue等JS框架进行学习，对此你至少需要掌握</p>
<ul>
<li>nodejs的安装，npm的基本使用</li>
<li>命令行的相关操作（包括git操作，vue-cli安装，创建项目，…命令行是必不可少的技能）</li>
<li>初步学习Vue，可能对其中的概念颇为不解。其实，如果先对React这样的框架做一些了解，上手Vue会快很多</li>
</ul>
</li>
<li><p>Vue还有一系列的组件</p>
<ul>
<li>webpack热加载和部署</li>
<li>vue-router路由</li>
<li>axios传递http请求</li>
<li>vuex存储</li>
<li>…</li>
</ul>
</li>
</ul>
<p>总得来说，我觉得快速把握这些东西，关键在于系统性地学习，去阅读乃至于自己搭建一个框架，了解前后端互动的过程</p>
<p>对我来说，学习路上受益最大的两个学习材料是</p>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://weblab.mit.edu/schedule/">weblab</a>，MIT开设的四周速成搭建网站课程，读下来真的是异常详细，以React为框架，Express为后端，MongoDB为数据库，搭建了一个自己的网站（后面的Socket编程还没看），总得来说就是让我体会到了大学的参差</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/PanJiaChen/vue-element-admin">vue-element-admin</a>和<a target="_blank" rel="noopener" href="https://github.com/PanJiaChen/vue-admin-template">vue-admin-template</a>国内最早也是目前最完善的后台前端解决方案</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/PanJiaChen/vue-element-admin">vue-element-admin</a>，其中的几篇掘金教程非常受益。当然其项目本身非常庞大，支持富文本、Excel等操作，对我们这种小型项目来说实在是杀鸡焉用牛刀了。因此更多地是参考<a target="_blank" rel="noopener" href="https://github.com/PanJiaChen/vue-admin-template">vue-admin-template</a>，几乎是对其中的源码全读了一遍，并理解了其中的大致原理</p>
</blockquote>
</li>
</ul>
<h1 id="git"><a href="#git" class="headerlink" title="git"></a>git</h1><p>前端的git我几乎全教了一遍（我是在之前a missing semester里学的git，加上实操后逐渐有所熟练），只能说希望世界上不会再有<code>Add files via upload</code>这样的commit message</p>
<p><img src="https://baokker-oss-blog-hangzhou.oss-cn-hangzhou.aliyuncs.com/cdn_for_blog/blog_imgs/image-20220904225409718.png" srcset="/img/loading.gif" lazyload alt="image-20220904225409718"></p>
<p>直接cv当时写的tips</p>
<blockquote>
<p>几个常用的命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash">git add &lt;filename&gt;<br>git add .<br>git add -A<br><br>git commit -am <span class="hljs-string">&#x27;commit message&#x27;</span><br><br>git checkout &lt;branchname&gt;<br>git checkout &lt;commithash&gt;<br>git checkout &lt;new_branch_name&gt; -b<br><br>git push<br>git push &lt;remotename&gt; &lt;branchname&gt;<br><span class="hljs-comment"># e.g. git push origin fbc # push to the fbc branch in origin</span><br><br>git <span class="hljs-built_in">rm</span> &lt;filename&gt;<br><br>git <span class="hljs-built_in">log</span> --all --graph <span class="hljs-comment"># history</span><br><br>git status <span class="hljs-comment"># check status</span><br><br>git pull <span class="hljs-comment"># use it every time you push or start coding</span><br><br>git merge &lt;branchname&gt; <span class="hljs-comment"># merge</span><br></code></pre></td></tr></table></figure>

<p><strong>不要使用</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">git push --force<br>git push -f<br></code></pre></td></tr></table></figure>

<p>可以用GitHub Desktop（当然，本质仍是命令行）</p>
</blockquote>
<h1 id="google"><a href="#google" class="headerlink" title="google"></a>google</h1><p>最后几天赶的时候有一段时间梯子挂了，真的特别难受，真的感受到自己已经不能离开Google了</p>
<ul>
<li>广告少</li>
<li>内容优质，除了Stack Overflow，medium之外，甚至我个人认为搜出来的CSDN也是Google匹配度更高，而且Google出来的思否、掘金文章也更多，怀疑…？</li>
<li>可以纯英文搜索，直接看英文问答和英文文档，不像百度，总得跳出来点中文</li>
</ul>
<p>只能说，Google在这方面赢百度太多太多了</p>
<p>（bing没怎么用过，不发表评论</p>
<h1 id="vue-2"><a href="#vue-2" class="headerlink" title="vue 2"></a>vue 2</h1><p>安装使用看教程</p>
<p>为什么不用vue3</p>
<ul>
<li>框架的相关教程不如vue2多，有各种适配问题</li>
<li>学长说vue2简单</li>
<li>可以参考的大多框架用vue2写的</li>
</ul>
<p>另外提一嘴，嫌vue-cli命令行麻烦的，其实可以在命令行中输入</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">vue ui<br></code></pre></td></tr></table></figure>

<p>打开ui界面部署</p>
<p><img src="https://baokker-oss-blog-hangzhou.oss-cn-hangzhou.aliyuncs.com/cdn_for_blog/blog_imgs/image-20220905090332927.png" srcset="/img/loading.gif" lazyload alt="image-20220905090332927"></p>
<h1 id="element-ui"><a href="#element-ui" class="headerlink" title="element ui"></a>element ui</h1><p>本来想试试Vuetify这种material design的主题的，奈何…element ui实在太多了（）</p>
<p>顺带评价一句，vue3的<a target="_blank" rel="noopener" href="https://element-plus.gitee.io/zh-CN/">element plus</a>文档感觉不如vue2的<a target="_blank" rel="noopener" href="https://element.eleme.cn/#/zh-CN">element ui</a>文档详细完备易懂</p>
<p>element ui的上手方法其实很简单：读文档，看他们的示例代码，ctrl c，ctrl v</p>
<p>我们组的两位美化大师也非常给力，在美化过程中引入了el-card，el-drawer，el-carousel（走马灯），v-loading，el-tag，el-pagination，el-input-number，el-select等一系列组件，可谓是物尽其用</p>
<h1 id="router"><a href="#router" class="headerlink" title="router"></a>router</h1><p>vue-router即路由，指定对应的地址（如<code>/Index</code>）对应的组件（<code>SystemIndex.vue</code>），写法上其实很简单</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Router</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue-router&quot;</span>;<br><br><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">NProgress</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;nprogress&quot;</span>; <span class="hljs-comment">// progress bar</span><br><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;nprogress/nprogress.css&quot;</span>; <span class="hljs-comment">// progress bar style</span><br><span class="hljs-title class_">NProgress</span>.<span class="hljs-title function_">configure</span>(&#123; <span class="hljs-attr">showSpinner</span>: <span class="hljs-literal">false</span> &#125;); <span class="hljs-comment">// NProgress Configuration</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * constantRoutes</span><br><span class="hljs-comment"> * a base page that does not have permission requirements</span><br><span class="hljs-comment"> * all roles can be accessed</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> constantRoutes = [<br>  &#123;<br>    <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;/&quot;</span>,<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;登录&quot;</span>,<br>    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">import</span>(<span class="hljs-string">&quot;../views/SystemLogin.vue&quot;</span>),<br>  &#125;,<br>  &#123;<br>    <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;/Register&quot;</span>,<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;注册&quot;</span>,<br>    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">import</span>(<span class="hljs-string">&quot;../views/SystemRegister.vue&quot;</span>),<br>  &#125;,<br>  &#123;<br>    <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;/404&quot;</span>,<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;404&quot;</span>,<br>    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">import</span>(<span class="hljs-string">&quot;../views/404.vue&quot;</span>),<br>    <span class="hljs-attr">hidden</span>: <span class="hljs-literal">true</span>,<br>  &#125;,<br>];<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * asyncRoutes</span><br><span class="hljs-comment"> * the routes that need to be dynamically loaded based on user roles</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> asyncRoutes = [<br>  &#123;<br>    <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;/Index&quot;</span>, <span class="hljs-comment">// forget to add Index !!!!!!</span><br>    <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;主页&quot;</span>,<br>    <span class="hljs-attr">redirect</span>: <span class="hljs-string">&quot;/AboutUs&quot;</span>,<br>    <span class="hljs-attr">meta</span>: &#123; <span class="hljs-attr">icon</span>: <span class="hljs-string">&quot;Home&quot;</span>, <span class="hljs-attr">roles</span>: [<span class="hljs-string">&quot;admin&quot;</span>, <span class="hljs-string">&quot;user&quot;</span>] &#125;,<br>    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">import</span>(<span class="hljs-string">&quot;../views/SystemIndex.vue&quot;</span>),<br>    <span class="hljs-attr">children</span>: [<br>      &#123;<br>        <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;/CovidBrowse&quot;</span>,<br>        <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;疫情速览&quot;</span>,<br>        <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">import</span>(<span class="hljs-string">&quot;../views/CovidBrowse.vue&quot;</span>),<br>        <span class="hljs-attr">meta</span>: &#123; <span class="hljs-attr">roles</span>: [<span class="hljs-string">&quot;admin&quot;</span>, <span class="hljs-string">&quot;user&quot;</span>] &#125;,<br>      &#125;,<br>      <span class="hljs-comment">// ...</span><br>        <br>  <span class="hljs-comment">// 404 page must be placed at the end !!!</span><br>  &#123;<br>    <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;*&quot;</span>,<br>    <span class="hljs-attr">redirect</span>: <span class="hljs-string">&quot;/404&quot;</span>,<br>    <span class="hljs-attr">hidden</span>: <span class="hljs-literal">true</span>,<br>  &#125;,<br>];<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">createRouter</span> = (<span class="hljs-params"></span>) =&gt;<br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Router</span>(&#123;<br>    <span class="hljs-attr">mode</span>: <span class="hljs-string">&quot;history&quot;</span>, <span class="hljs-comment">// require service support</span><br>    <span class="hljs-attr">scrollBehavior</span>: <span class="hljs-function">() =&gt;</span> (&#123; <span class="hljs-attr">y</span>: <span class="hljs-number">0</span> &#125;),<br>        <span class="hljs-attr">routes</span>: constantRoutes,<br>&#125;);<br><br><span class="hljs-keyword">const</span> router = <span class="hljs-title function_">createRouter</span>();<br></code></pre></td></tr></table></figure>

<p>几个技术点</p>
<ul>
<li><p>分为了constantRoutes和asyncRoutes，是因为后续还增加了权限验证，判断哪些页面可以访问哪些页面不可访问，这些都需要动态生成</p>
</li>
<li><p>router默认的模式是hash模式，该方法的缺点是地址栏都是形如<code>/#/Index</code>，前面带个#号，因此用<code>mode: &quot;history&quot;</code>修改为history模式（当然，这都是相对的，用hash模式部署开发的时候会比history方便）</p>
</li>
<li><p>最后这段</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js">&#123;<br>  <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;*&quot;</span>,<br>  <span class="hljs-attr">redirect</span>: <span class="hljs-string">&quot;/404&quot;</span>,<br>  <span class="hljs-attr">hidden</span>: <span class="hljs-literal">true</span>,<br>&#125;,<br></code></pre></td></tr></table></figure>

<p>是通配符，意味着如果有网址在之前所有的路由里都没匹配，就将其重定向到404页面</p>
</li>
</ul>
<p>除此之外，路由还可以设置拦截，在每个页面跳转间执行操作。to即为前往的路由，from即为出发的路由，就像英语中from…to…一样</p>
<p>NProgress是一个加载进度条的插件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">//路由拦截</span><br>router.<span class="hljs-title function_">beforeEach</span>(<span class="hljs-function">(<span class="hljs-params">to, <span class="hljs-keyword">from</span>, next</span>) =&gt;</span> &#123;<br>  <span class="hljs-comment">// start progress bar</span><br>  <span class="hljs-title class_">NProgress</span>.<span class="hljs-title function_">start</span>();<br><br>  <span class="hljs-comment">// set page title</span><br>  <span class="hljs-variable language_">document</span>.<span class="hljs-property">title</span> = <span class="hljs-string">`<span class="hljs-subst">$&#123;to.name&#125;</span> - 疫情防控系统`</span>;<br>  <br>  <span class="hljs-comment">// 剩余内容涉及路由拦截，等下文再介绍</span><br>&#125;<br>                  <br>router.<span class="hljs-title function_">afterEach</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-comment">// finish progress bar</span><br>  <span class="hljs-title class_">NProgress</span>.<span class="hljs-title function_">done</span>();<br>&#125;);<br></code></pre></td></tr></table></figure>

<h1 id="axios"><a href="#axios" class="headerlink" title="axios"></a>axios</h1><p>axios听起来难，但写起来其实也很方便，它对http请求做了一个很好的封装</p>
<p>首先我们要理解，http请求简单来说，就是对一个url做一些操作，一般有get（获取），post（增加），put（修改），delete（删除）等。</p>
<p>首先在<code>plugins/axios.js</code>中配置axios</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;axios&quot;</span>;<br><span class="hljs-keyword">import</span> store <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/store&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; getToken &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/utils/auth&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Message</span>,<span class="hljs-title class_">MessageBox</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;element-ui&quot;</span>;<br><br><span class="hljs-keyword">const</span> service = axios.<span class="hljs-title function_">create</span>(&#123;<br>  <span class="hljs-attr">baseURL</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">VUE_APP_BASE_URL</span>,<br>  <span class="hljs-attr">timeout</span>: <span class="hljs-number">5000</span>,<br>&#125;);<br><br>service.<span class="hljs-property">interceptors</span>.<span class="hljs-property">request</span>.<span class="hljs-title function_">use</span>(<br>  <span class="hljs-function">(<span class="hljs-params">config</span>) =&gt;</span> &#123;<br>    <span class="hljs-comment">// do something before request is sent</span><br>    <span class="hljs-keyword">if</span> (store.<span class="hljs-property">getters</span>.<span class="hljs-property">token</span>) &#123;<br>      config.<span class="hljs-property">headers</span>[<span class="hljs-string">&quot;Token&quot;</span>] = <span class="hljs-title function_">getToken</span>();<br>    &#125;<br><br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(config);<br>    <span class="hljs-keyword">return</span> config;<br>  &#125;,<br>  <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> &#123;<br>    <span class="hljs-comment">// do something with request error</span><br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(error); <span class="hljs-comment">// for debug</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(error);<br>  &#125;<br>);<br><br>service.<span class="hljs-property">interceptors</span>.<span class="hljs-property">response</span>.<span class="hljs-title function_">use</span>(<br>  <span class="hljs-function">(<span class="hljs-params">response</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> res = response.<span class="hljs-property">data</span>;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res);<br>    <span class="hljs-comment">// if the custom code is not 20000, it is judged as an error.</span><br>    <span class="hljs-keyword">if</span> (res.<span class="hljs-property">code</span> !== <span class="hljs-number">20000</span> &amp;&amp; res.<span class="hljs-property">code</span>!==<span class="hljs-number">200</span>) &#123;<br>      <span class="hljs-title class_">Message</span>(&#123;<br>        <span class="hljs-attr">message</span>: res.<span class="hljs-property">message</span> || <span class="hljs-string">&quot;Error&quot;</span>,<br>        <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;error&quot;</span>,<br>      &#125;);<br><br>      <span class="hljs-comment">// 50008: Illegal token; 50012: Other clients logged in; 50014: Token expired;</span><br>      <span class="hljs-keyword">if</span> (res.<span class="hljs-property">code</span> === <span class="hljs-number">50008</span> || res.<span class="hljs-property">code</span> === <span class="hljs-number">50012</span> || res.<span class="hljs-property">code</span> === <span class="hljs-number">50014</span>) &#123;<br>        <span class="hljs-comment">// to re-login</span><br>        <span class="hljs-title class_">MessageBox</span>.<span class="hljs-title function_">confirm</span>(<br>          <span class="hljs-string">&quot;您已登出，您可以取消留在此页面，或重新登入&quot;</span>,<br>          <span class="hljs-string">&quot;确认登出&quot;</span>,<br>          &#123;<br>            <span class="hljs-attr">confirmButtonText</span>: <span class="hljs-string">&quot;Re-Login&quot;</span>,<br>            <span class="hljs-attr">cancelButtonText</span>: <span class="hljs-string">&quot;Cancel&quot;</span>,<br>            <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;warning&quot;</span>,<br>          &#125;<br>        ).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>          store.<span class="hljs-title function_">dispatch</span>(<span class="hljs-string">&quot;user/resetToken&quot;</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>            location.<span class="hljs-title function_">reload</span>();<br>          &#125;);<br>        &#125;);<br>      &#125;<br>      <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(res.<span class="hljs-property">message</span> || <span class="hljs-string">&quot;Error&quot;</span>));<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-keyword">return</span> res;<br>    &#125;<br>  &#125;,<br>  <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;err&quot;</span> + error); <span class="hljs-comment">// for debug</span><br>    <span class="hljs-title class_">Message</span>(&#123;<br>      <span class="hljs-attr">message</span>: error.<span class="hljs-property">message</span>,<br>      <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;error&quot;</span>,<br>    &#125;);<br>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(error);<br>  &#125;<br>);<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> service<br></code></pre></td></tr></table></figure>

<p>看起来有些长，其实要点就这几个</p>
<ul>
<li><p>创建了一个axios服务，设置了baseURL为process.env.VUE_APP_BASE_URL，这在之后的环境变量配置里会提到</p>
</li>
<li><p>设置了request和response拦截器</p>
<ul>
<li><p>request即我们前端向后端发送的请求。由于权限验证，我们会在发送请求的同时在请求头加上token（由用户信息加密形成的一串字符串），交由后端校验，如果token出现问题（过期&#x2F;在别处登录等），则拒绝请求</p>
</li>
<li><p>response即后端返回的回应。一般后端返回的数据（如前后端约定的custom code，后端返回的数据或错误信息），都会放在response的data字段里。因此我们在拦截器里直接const res &#x3D; response.data，将res返回，这样就避免在前端通过<code>res.data.data</code>这样的字段引用的麻烦之嫌</p>
<p>我们默认后端会返回一个code作为状态</p>
<ul>
<li>code为20000，表示正常</li>
<li>code !&#x3D; 20000，输出回应的message字段，表示错误信息（假如有的话）</li>
<li>如果code与token相关（50008: Illegal token; 50012: Other clients logged in; 50014: Token expired），则登出</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>再在<code>main.js</code>里引入</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// axios</span><br><span class="hljs-keyword">import</span> service <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./plugins/axios&quot;</span>;<br><span class="hljs-title class_">Vue</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">$axios</span> = service;<br></code></pre></td></tr></table></figure>

<p>这样在前端即可通过</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">this</span>.<span class="hljs-property">$axios</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;/api&quot;</span>,&#123;<span class="hljs-attr">params</span>:&#123;<span class="hljs-attr">userID</span>:<span class="hljs-number">1</span>&#125;&#125;).<span class="hljs-title function_">then</span>(..).<span class="hljs-title function_">catch</span>(..)<br><span class="hljs-variable language_">this</span>.<span class="hljs-property">$axios</span>.<span class="hljs-title function_">post</span>(<span class="hljs-string">&quot;/api&quot;</span>,&#123;<span class="hljs-attr">userID</span>:<span class="hljs-number">1</span>&#125;).<span class="hljs-title function_">then</span>(..).<span class="hljs-title function_">catch</span>(..)<br></code></pre></td></tr></table></figure>

<p>的方式发送请求</p>
<p>注意一下，get请求如果带参数，都<strong>必须放入params字段中</strong>，然后axios会将其转为形如“xxx?userID&#x3D;1”的url；其他post，delete，put则都是放入data字段中</p>
<h1 id="api"><a href="#api" class="headerlink" title="api"></a>api</h1><p>我们参考的<a target="_blank" rel="noopener" href="https://github.com/liutengjian66/COVID">COVID</a>就是用axios请求写到底。一开始我们也是这么做的，但是最后我们还是做了封装，主要还是让后端方便一些，axios的原始写法固然简单，但是零散在各个角落里，找起来太累了</p>
<p><img src="https://baokker-oss-blog-hangzhou.oss-cn-hangzhou.aliyuncs.com/cdn_for_blog/blog_imgs/image-20220905100532424.png" srcset="/img/loading.gif" lazyload alt="image-20220905100532424"></p>
<p><img src="https://baokker-oss-blog-hangzhou.oss-cn-hangzhou.aliyuncs.com/cdn_for_blog/blog_imgs/image-20220905100615533.png" srcset="/img/loading.gif" lazyload alt="image-20220905100615533"></p>
<p>基本就是这种写法</p>
<h1 id="mock"><a href="#mock" class="headerlink" title="mock"></a>mock</h1><p>mock最主要的作用还是前后端分离。后端还在开发的时候，前端可以先用mock拦截请求，自己定义返回的数据，来测试页面的效果和逻辑。</p>
<p>此项目默认在development环境（即npm run serve）时启用mock，在production（npm run build）时不启用（见main.js)</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// mockjs</span><br><span class="hljs-keyword">if</span> (process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> == <span class="hljs-string">&quot;development&quot;</span>) &#123;<br>  <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;../mock/index&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>新建mock&#x2F;index.js，以下是几个示例。注意axios传过来的data格式默认为JSON，所以必须先解析</p>
<p><img src="https://baokker-oss-blog-hangzhou.oss-cn-hangzhou.aliyuncs.com/cdn_for_blog/blog_imgs/image-20220905101351853.png" srcset="/img/loading.gif" lazyload alt="image-20220905101351853"></p>
<p>传过来的get如果带参数，会变成后面带有问号的形式，正确的处理方法是用正则表达式接收所有匹配的请求，再用特定函数转为所需内容</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> <span class="hljs-title class_">Mock</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;mockjs&quot;</span>);<br><br><span class="hljs-keyword">const</span> baseURL = process.<span class="hljs-property">env</span>.<span class="hljs-property">VUE_APP_BASE_URL</span>;<br><br><span class="hljs-comment">// process.env是node环境变量</span><br><span class="hljs-comment">// development环境下本地开发环境下自己配的</span><br><span class="hljs-comment">// BASE_URL地址,即:开发环境的接口域名</span><br><span class="hljs-title class_">Mock</span>.<span class="hljs-title function_">setup</span>(&#123;<br>  <span class="hljs-attr">timeout</span>: <span class="hljs-number">20</span>,<br>&#125;);<br><br><span class="hljs-comment">// get请求 不带params</span><br><span class="hljs-title class_">Mock</span>.<span class="hljs-title function_">mock</span>(baseURL + <span class="hljs-string">&quot;/manage&quot;</span>, <span class="hljs-string">&quot;get&quot;</span>, &#123;<br>  <span class="hljs-attr">code</span>: <span class="hljs-number">20000</span>,<br>  <span class="hljs-attr">data</span>: &#123;<br>    <span class="hljs-attr">manageRecord</span>: [<br>      &#123;<br>        <span class="hljs-attr">unitId</span>: <span class="hljs-string">&quot;11&quot;</span>,<br>        <span class="hljs-attr">unitName</span>: <span class="hljs-string">&quot;haha&quot;</span>,<br>        <span class="hljs-attr">personId</span>: <span class="hljs-string">&quot;22&quot;</span>,<br>        <span class="hljs-attr">personName</span>: <span class="hljs-string">&quot;huhu&quot;</span>,<br>      &#125;,<br>      &#123;<br>        <span class="hljs-attr">unitId</span>: <span class="hljs-string">&quot;33&quot;</span>,<br>        <span class="hljs-attr">unitName</span>: <span class="hljs-string">&quot;haha&quot;</span>,<br>        <span class="hljs-attr">personId</span>: <span class="hljs-string">&quot;22&quot;</span>,<br>        <span class="hljs-attr">personName</span>: <span class="hljs-string">&quot;huhu&quot;</span>,<br>      &#125;,<br>    ],<br>  &#125;,<br>&#125;);<br><br><span class="hljs-comment">// post请求 解析</span><br><span class="hljs-title class_">Mock</span>.<span class="hljs-title function_">mock</span>(baseURL + <span class="hljs-string">&quot;/user/login&quot;</span>, <span class="hljs-string">&quot;post&quot;</span>, <span class="hljs-function">(<span class="hljs-params">config</span>) =&gt;</span> &#123;<br>  <span class="hljs-comment">// 传递过来的是JSON 必须要先解析！之后考虑封装吧 现在还只是测试</span><br>  config.<span class="hljs-property">body</span> = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(config.<span class="hljs-property">body</span>);<br><br>  <span class="hljs-keyword">if</span> (<br>    (config.<span class="hljs-property">body</span>.<span class="hljs-property">userName</span> != <span class="hljs-string">&quot;admin&quot;</span> &amp;&amp; config.<span class="hljs-property">body</span>.<span class="hljs-property">userName</span> != <span class="hljs-string">&quot;user&quot;</span>) ||<br>    config.<span class="hljs-property">body</span>.<span class="hljs-property">passWord</span> != <span class="hljs-string">&quot;12345678&quot;</span><br>  ) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Account and password are incorrect.&quot;</span>);<br>    <span class="hljs-keyword">return</span> &#123;<br>      <span class="hljs-attr">code</span>: <span class="hljs-number">60204</span>,<br>      <span class="hljs-attr">message</span>: <span class="hljs-string">&quot;账号或密码错误！&quot;</span>,<br>    &#125;;<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;login successfully&quot;</span>);<br>    <span class="hljs-keyword">return</span> &#123;<br>      <span class="hljs-attr">code</span>: <span class="hljs-number">20000</span>,<br>      <span class="hljs-attr">token</span>: config.<span class="hljs-property">body</span>.<span class="hljs-property">userName</span> + <span class="hljs-string">&quot;-token&quot;</span>,<br>    &#125;;<br>  &#125;<br>&#125;);<br><br><span class="hljs-comment">// get 带参数</span><br><br><span class="hljs-comment">// 将后面的参数转为对象</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">param2Obj</span>(<span class="hljs-params">url</span>) &#123;<br>  <span class="hljs-keyword">const</span> search = <span class="hljs-built_in">decodeURIComponent</span>(url.<span class="hljs-title function_">split</span>(<span class="hljs-string">&quot;?&quot;</span>)[<span class="hljs-number">1</span>]).<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\+/g</span>, <span class="hljs-string">&quot; &quot;</span>);<br>  <span class="hljs-keyword">if</span> (!search) &#123;<br>    <span class="hljs-keyword">return</span> &#123;&#125;;<br>  &#125;<br>  <span class="hljs-keyword">const</span> obj = &#123;&#125;;<br>  <span class="hljs-keyword">const</span> searchArr = search.<span class="hljs-title function_">split</span>(<span class="hljs-string">&quot;&amp;&quot;</span>);<br>  searchArr.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">v</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> index = v.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">&quot;=&quot;</span>);<br>    <span class="hljs-keyword">if</span> (index !== -<span class="hljs-number">1</span>) &#123;<br>      <span class="hljs-keyword">const</span> name = v.<span class="hljs-title function_">substring</span>(<span class="hljs-number">0</span>, index);<br>      <span class="hljs-keyword">const</span> val = v.<span class="hljs-title function_">substring</span>(index + <span class="hljs-number">1</span>, v.<span class="hljs-property">length</span>);<br>      obj[name] = val;<br>    &#125;<br>  &#125;);<br>  <span class="hljs-keyword">return</span> obj;<br>&#125;<br><br><span class="hljs-comment">// 正则匹配，根据token返回admin或user身份信息</span><br><span class="hljs-title class_">Mock</span>.<span class="hljs-title function_">mock</span>(<span class="hljs-title class_">RegExp</span>(baseURL + <span class="hljs-string">&quot;/user/info.*&quot;</span>), <span class="hljs-string">&quot;get&quot;</span>, <span class="hljs-function">(<span class="hljs-params">config</span>) =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;User info&quot;</span>, config.<span class="hljs-property">url</span>);<br>  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">param2Obj</span>(config.<span class="hljs-property">url</span>).<span class="hljs-property">token</span>.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&quot;admin&quot;</span>)) &#123;<br>    <span class="hljs-keyword">return</span> &#123;<br>      <span class="hljs-attr">code</span>: <span class="hljs-number">20000</span>,<br>      <span class="hljs-attr">data</span>: &#123;<br>        <span class="hljs-attr">roles</span>: [<span class="hljs-string">&quot;admin&quot;</span>],<br>        <span class="hljs-attr">ID</span>: <span class="hljs-string">&quot;2051563&quot;</span>,<br>        <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;admin&quot;</span>,<br>        <span class="hljs-attr">gender</span>: <span class="hljs-number">1</span>,<br>        <span class="hljs-attr">phoneNumber</span>: <span class="hljs-string">&quot;&quot;</span>,<br>        <span class="hljs-attr">age</span>: <span class="hljs-number">0</span>,<br>      &#125;,<br>    &#125;;<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">return</span> &#123;<br>      <span class="hljs-attr">code</span>: <span class="hljs-number">20000</span>,<br>      <span class="hljs-attr">data</span>: &#123;<br>        <span class="hljs-attr">roles</span>: [<span class="hljs-string">&quot;user&quot;</span>],<br>        <span class="hljs-attr">ID</span>: <span class="hljs-string">&quot;456&quot;</span>,<br>        <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;user&quot;</span>,<br>        <span class="hljs-attr">gender</span>: <span class="hljs-number">0</span>,<br>        <span class="hljs-attr">phoneNumber</span>: <span class="hljs-string">&quot;12345678&quot;</span>,<br>        <span class="hljs-attr">age</span>: <span class="hljs-number">20</span>,<br>      &#125;,<br>    &#125;;<br>  &#125;<br>&#125;);<br></code></pre></td></tr></table></figure>

<p>mock还有Random模块很重要，不过这次项目并没有用到，以后再说。</p>
<h1 id="vuex"><a href="#vuex" class="headerlink" title="vuex"></a>vuex</h1><p><a target="_blank" rel="noopener" href="https://www.51cto.com/article/686468.html%E5%92%8Cvuex%E7%9A%84%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E5%8F%AF%E4%BB%A5%E7%9C%8B%E7%9C%8B%EF%BC%8C%E8%BF%99%E9%87%8C%E9%9D%A2%E4%B8%9C%E8%A5%BF%E6%8C%BA%E5%A4%9A%EF%BC%8C%E6%88%91%E5%8F%AA%E5%AD%A6%E4%BA%86%E6%88%91%E4%BB%AC%E9%9C%80%E8%A6%81%E7%9A%84%E9%83%A8%E5%88%86">https://www.51cto.com/article/686468.html和vuex的官方文档可以看看，这里面东西挺多，我只学了我们需要的部分</a></p>
<p>首先，vuex相当于一个存储器，将多个组件都会用到的变量都集中存在vuex中</p>
<p><img src="https://baokker-oss-blog-hangzhou.oss-cn-hangzhou.aliyuncs.com/cdn_for_blog/blog_imgs/image-20220905102551388.png" srcset="/img/loading.gif" lazyload alt="image-20220905102551388"></p>
<p>Index.js（多module方法）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vuex</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vuex&quot;</span>;<br><span class="hljs-keyword">import</span> user <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./modules/user&quot;</span>;<br><span class="hljs-keyword">import</span> permission <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./modules/permission&quot;</span>;<br><span class="hljs-keyword">import</span> getters <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./getters&quot;</span>;<br><br><span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">use</span>(<span class="hljs-title class_">Vuex</span>)<br><br><span class="hljs-keyword">const</span> store = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vuex</span>.<span class="hljs-title class_">Store</span>(&#123;<br>  <span class="hljs-attr">modules</span>: &#123;<br>    user,<br>    permission,<br>  &#125;,<br>  getters,<br>&#125;)<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> store<br></code></pre></td></tr></table></figure>

<p>getters.js（很像vue的computed，不是吗），定义后可在全局用类似<code>this.$store.getters.token</code>的方法获取数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> getters = &#123;<br>  <span class="hljs-attr">token</span>: <span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> state.<span class="hljs-property">user</span>.<span class="hljs-property">token</span>,<br>  <span class="hljs-attr">ID</span>:<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> state.<span class="hljs-property">user</span>.<span class="hljs-property">ID</span>,<br>  <span class="hljs-attr">name</span>: <span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> state.<span class="hljs-property">user</span>.<span class="hljs-property">name</span>,<br>  <span class="hljs-attr">roles</span>: <span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> state.<span class="hljs-property">user</span>.<span class="hljs-property">roles</span>,<br>  <span class="hljs-attr">phoneNumber</span>: <span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> state.<span class="hljs-property">user</span>.<span class="hljs-property">phoneNumber</span>,<br>  <span class="hljs-attr">age</span>: <span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> state.<span class="hljs-property">user</span>.<span class="hljs-property">age</span>,<br>  <span class="hljs-attr">gender</span>: <span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> (state.<span class="hljs-property">user</span>.<span class="hljs-property">gender</span> == <span class="hljs-string">&quot;1 &quot;</span> ? <span class="hljs-string">&quot;男&quot;</span> : <span class="hljs-string">&quot;女&quot;</span>),<br>  <span class="hljs-attr">permission_routes</span>: <span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> state.<span class="hljs-property">permission</span>.<span class="hljs-property">routes</span>,<br>&#125;;<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> getters;<br></code></pre></td></tr></table></figure>

<p>重点讲讲user.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123; getToken, setToken, removeToken &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/utils/auth&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; resetRouter &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/router&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; login, getInfo &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/api/user.js&quot;</span>;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">getDefaultState</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">return</span> &#123;<br>    <span class="hljs-attr">token</span>: <span class="hljs-title function_">getToken</span>(),<br>    <span class="hljs-attr">ID</span>: <span class="hljs-string">&quot;&quot;</span>,<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;&quot;</span>,<br>    <span class="hljs-attr">roles</span>: [],<br>    <span class="hljs-attr">gender</span>: <span class="hljs-number">1</span>, <span class="hljs-comment">// 1 = male, 0 = female</span><br>    <span class="hljs-attr">phoneNumber</span>: <span class="hljs-string">&quot;&quot;</span>,<br>    <span class="hljs-attr">age</span>: <span class="hljs-number">0</span>,<br>  &#125;;<br>&#125;;<br><br><span class="hljs-keyword">const</span> state = &#123;<br>  <span class="hljs-attr">token</span>: <span class="hljs-title function_">getToken</span>(),<br>  <span class="hljs-attr">ID</span>: <span class="hljs-string">&quot;&quot;</span>,<br>  <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;&quot;</span>,<br>  <span class="hljs-attr">roles</span>: [],<br>  <span class="hljs-attr">gender</span>: <span class="hljs-number">1</span>, <span class="hljs-comment">// 1 = male, 0 = female</span><br>  <span class="hljs-attr">phoneNumber</span>: <span class="hljs-string">&quot;&quot;</span>,<br>  <span class="hljs-attr">age</span>: <span class="hljs-number">0</span>,<br>&#125;;<br><br><span class="hljs-keyword">const</span> mutations = &#123;<br>  <span class="hljs-attr">RESET_STATE</span>: <span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> &#123;<br>    <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(state, <span class="hljs-title function_">getDefaultState</span>());<br>  &#125;,<br>  <span class="hljs-attr">SET_TOKEN</span>: <span class="hljs-function">(<span class="hljs-params">state, token</span>) =&gt;</span> &#123;<br>    state.<span class="hljs-property">token</span> = token;<br>  &#125;,<br>  <span class="hljs-attr">SET_ID</span>: <span class="hljs-function">(<span class="hljs-params">state, ID</span>) =&gt;</span> &#123;<br>    state.<span class="hljs-property">ID</span> = <span class="hljs-variable constant_">ID</span>;<br>  &#125;,<br>  <span class="hljs-attr">SET_NAME</span>: <span class="hljs-function">(<span class="hljs-params">state, name</span>) =&gt;</span> &#123;<br>    state.<span class="hljs-property">name</span> = name;<br>  &#125;,<br>  <span class="hljs-attr">SET_ROLES</span>: <span class="hljs-function">(<span class="hljs-params">state, roles</span>) =&gt;</span> &#123;<br>    state.<span class="hljs-property">roles</span> = roles;<br>  &#125;,<br>  <span class="hljs-attr">SET_GENDER</span>: <span class="hljs-function">(<span class="hljs-params">state, gender</span>) =&gt;</span> &#123;<br>    state.<span class="hljs-property">gender</span> = gender;<br>  &#125;,<br>  <span class="hljs-attr">SET_AGE</span>: <span class="hljs-function">(<span class="hljs-params">state, age</span>) =&gt;</span> &#123;<br>    state.<span class="hljs-property">age</span> = age;<br>  &#125;,<br>  <span class="hljs-attr">SET_PHONE_NUMBER</span>: <span class="hljs-function">(<span class="hljs-params">state, phoneNumber</span>) =&gt;</span> &#123;<br>    state.<span class="hljs-property">phoneNumber</span> = phoneNumber;<br>  &#125;,<br>&#125;;<br><br><span class="hljs-keyword">const</span> actions = &#123;<br>  <span class="hljs-comment">// user login</span><br>  <span class="hljs-title function_">login</span>(<span class="hljs-params">&#123; commit &#125;, userInfo</span>) &#123;<br>    <span class="hljs-keyword">const</span> &#123; userName, passWord &#125; = userInfo;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;<br>      <span class="hljs-title function_">login</span>(&#123; <span class="hljs-attr">userName</span>: userName.<span class="hljs-title function_">trim</span>(), <span class="hljs-attr">passWord</span>: passWord &#125;)<br>        .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;<br>          <span class="hljs-keyword">const</span> &#123; token &#125; = res;<br>          <span class="hljs-comment">// const &#123; token, data&#125; = res;</span><br><br>          <span class="hljs-title function_">commit</span>(<span class="hljs-string">&quot;SET_TOKEN&quot;</span>, token);<br>          <span class="hljs-title function_">setToken</span>(token);<br><br>          <span class="hljs-comment">// const &#123; roles, ID, name, gender, phoneNumber, age &#125; = data;</span><br>          <span class="hljs-comment">// // roles must be a non-empty array</span><br>          <span class="hljs-comment">// if (!roles || roles.length &lt;= 0) &#123;</span><br>          <span class="hljs-comment">//   reject(&quot;getInfo: roles must be a non-null array!&quot;);</span><br>          <span class="hljs-comment">// &#125;</span><br><br>          <span class="hljs-comment">// commit(&quot;SET_ROLES&quot;, roles);</span><br>          <span class="hljs-comment">// commit(&quot;SET_ID&quot;, ID);</span><br>          <span class="hljs-comment">// commit(&quot;SET_NAME&quot;, name);</span><br>          <span class="hljs-comment">// commit(&quot;SET_GENDER&quot;, gender);</span><br>          <span class="hljs-comment">// commit(&quot;SET_PHONE_NUMBER&quot;, phoneNumber);</span><br>          <span class="hljs-comment">// commit(&quot;SET_AGE&quot;, age);</span><br><br>          <span class="hljs-title function_">resolve</span>();<br>        &#125;)<br>        .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> &#123;<br>          <span class="hljs-title function_">reject</span>(error);<br>        &#125;);<br>    &#125;);<br>  &#125;,<br><br>  <span class="hljs-comment">// get user info</span><br>  <span class="hljs-title function_">getInfo</span>(<span class="hljs-params">&#123; commit &#125;</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;<br>      <span class="hljs-comment">// getInfo(state.token)</span><br>      <span class="hljs-title function_">getInfo</span>(state.<span class="hljs-property">token</span>)<br>        .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;<br>          <span class="hljs-keyword">const</span> &#123; data &#125; = res;<br><br>          <span class="hljs-keyword">if</span> (!data) &#123;<br>            <span class="hljs-title function_">reject</span>(<span class="hljs-string">&quot;Verification failed, please Login again.&quot;</span>);<br>          &#125;<br><br>          <span class="hljs-keyword">const</span> &#123; roles, <span class="hljs-variable constant_">ID</span>, name, gender, phoneNumber, age &#125; = data;<br>          <span class="hljs-comment">// roles must be a non-empty array</span><br>          <span class="hljs-keyword">if</span> (!roles || roles.<span class="hljs-property">length</span> &lt;= <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-title function_">reject</span>(<span class="hljs-string">&quot;getInfo: roles must be a non-null array!&quot;</span>);<br>          &#125;<br><br>          <span class="hljs-title function_">commit</span>(<span class="hljs-string">&quot;SET_ROLES&quot;</span>, roles);<br>          <span class="hljs-title function_">commit</span>(<span class="hljs-string">&quot;SET_ID&quot;</span>, <span class="hljs-variable constant_">ID</span>);<br>          <span class="hljs-title function_">commit</span>(<span class="hljs-string">&quot;SET_NAME&quot;</span>, name);<br>          <span class="hljs-title function_">commit</span>(<span class="hljs-string">&quot;SET_GENDER&quot;</span>, gender);<br>          <span class="hljs-title function_">commit</span>(<span class="hljs-string">&quot;SET_PHONE_NUMBER&quot;</span>, phoneNumber);<br>          <span class="hljs-title function_">commit</span>(<span class="hljs-string">&quot;SET_AGE&quot;</span>, age);<br><br>          <span class="hljs-title function_">resolve</span>(data);<br>        &#125;)<br>        .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> &#123;<br>          <span class="hljs-title function_">reject</span>(error);<br>        &#125;);<br>    &#125;);<br>  &#125;,<br><br>  <span class="hljs-comment">// user logout</span><br>  <span class="hljs-title function_">logout</span>(<span class="hljs-params">&#123; commit &#125;</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;<br>      <span class="hljs-title function_">removeToken</span>(); <span class="hljs-comment">// must remove token first</span><br>      <span class="hljs-title function_">resetRouter</span>();<br>      <span class="hljs-title function_">commit</span>(<span class="hljs-string">&quot;RESET_STATE&quot;</span>);<br>      <span class="hljs-title function_">resolve</span>();<br>    &#125;);<br>  &#125;,<br><br>  <span class="hljs-comment">// remove token</span><br>  <span class="hljs-title function_">resetToken</span>(<span class="hljs-params">&#123; commit &#125;</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> &#123;<br>      <span class="hljs-title function_">removeToken</span>(); <span class="hljs-comment">// must remove  token  first</span><br>      <span class="hljs-title function_">commit</span>(<span class="hljs-string">&quot;RESET_STATE&quot;</span>);<br>      <span class="hljs-title function_">resolve</span>();<br>    &#125;);<br>  &#125;,<br>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;<br>  <span class="hljs-attr">namespaced</span>: <span class="hljs-literal">true</span>,<br>  state,<br>  mutations,<br>  actions,<br>&#125;;<br></code></pre></td></tr></table></figure>

<ul>
<li><p>state 存放 vuex 的基本数据，用来存储变量</p>
</li>
<li><p>mutations 用来更改state，通过commit调用（这是同步的）</p>
</li>
<li><p>actions 是异步的，用于替代mutations的同步操作（前端开发经常会为了保证响应速度，用到异步操作），通过dispatch调用，例如</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">this</span>.<span class="hljs-property">$store</span><br>    .<span class="hljs-title function_">dispatch</span>(<span class="hljs-string">&quot;user/login&quot;</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">loginForm</span>)<br>    .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">$router</span>.<span class="hljs-title function_">push</span>(&#123; <span class="hljs-attr">path</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">redirect</span> || <span class="hljs-string">&quot;/Index&quot;</span> &#125;,<span class="hljs-function">()=&gt;</span> &#123;&#125;);<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">loading</span> = <span class="hljs-literal">false</span>;<br>&#125;)<br>    .<span class="hljs-title function_">catch</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">loading</span> = <span class="hljs-literal">false</span>;<br>&#125;);<br></code></pre></td></tr></table></figure></li>
</ul>
<p>最后在main.js引入</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// store</span><br><span class="hljs-keyword">import</span> store <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./store&quot;</span>;<br></code></pre></td></tr></table></figure>

<p>vuex的一个重要特点是<strong>刷新后会消失</strong>，对此我们的处理方法是，在每次路由拦截时尝试获取该用户的roles，如果vuex中没有存储（表示第一次登录或者已经刷新了），则调用getInfo的api，重新用vuex存储。(token用js-cookie存储，因此可以持久存储)</p>
<h1 id="验证码"><a href="#验证码" class="headerlink" title="验证码"></a>验证码</h1><p>全是参考这篇的</p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/7029343961168740366">https://juejin.cn/post/7029343961168740366</a></p>
<h1 id="网页拦截，动态路由"><a href="#网页拦截，动态路由" class="headerlink" title="网页拦截，动态路由"></a>网页拦截，动态路由</h1><p>这是全篇最难的地方，要点有</p>
<ul>
<li>如果用户没有登录，只能强制返回登录页</li>
<li>如果登陆了（提一嘴，本项目mock里，用户名只有user，admin，密码只有12345678）<ul>
<li>需要根据用户的权限，动态生成路由列表</li>
<li>访问不该访问的列表时，返回404</li>
</ul>
</li>
</ul>
<p>直接贴吧</p>
<p>首先是配置router的meta属性，加上roles</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * asyncRoutes</span><br><span class="hljs-comment"> * the routes that need to be dynamically loaded based on user roles</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> asyncRoutes = [<br>  &#123;<br>    <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;/Index&quot;</span>, <span class="hljs-comment">// forget to add Index !!!!!!</span><br>    <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;主页&quot;</span>,<br>    <span class="hljs-attr">redirect</span>: <span class="hljs-string">&quot;/AboutUs&quot;</span>,<br>    <span class="hljs-attr">meta</span>: &#123; <span class="hljs-attr">icon</span>: <span class="hljs-string">&quot;Home&quot;</span>, <span class="hljs-attr">roles</span>: [<span class="hljs-string">&quot;admin&quot;</span>, <span class="hljs-string">&quot;user&quot;</span>] &#125;,<br>    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">import</span>(<span class="hljs-string">&quot;../views/SystemIndex.vue&quot;</span>),<br>    <span class="hljs-attr">children</span>: [<br>      &#123;<br>        <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;/CovidBrowse&quot;</span>,<br>        <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;疫情速览&quot;</span>,<br>        <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">import</span>(<span class="hljs-string">&quot;../views/CovidBrowse.vue&quot;</span>),<br>        <span class="hljs-attr">meta</span>: &#123; <span class="hljs-attr">roles</span>: [<span class="hljs-string">&quot;admin&quot;</span>, <span class="hljs-string">&quot;user&quot;</span>] &#125;,<br>      &#125;,<br><br>      &#123;<br>        <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;/CovidProtection&quot;</span>,<br>        <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;防控指南&quot;</span>,<br>        <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">import</span>(<span class="hljs-string">&quot;../views/CovidProtection.vue&quot;</span>),<br>        <span class="hljs-attr">meta</span>: &#123; <span class="hljs-attr">roles</span>: [<span class="hljs-string">&quot;admin&quot;</span>, <span class="hljs-string">&quot;user&quot;</span>] &#125;,<br>      &#125;,<br>      &#123;<br>        <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;/AboutUs&quot;</span>,<br>        <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;网站简介&quot;</span>,<br>        <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">import</span>(<span class="hljs-string">&quot;../views/Home.vue&quot;</span>),<br>        <span class="hljs-attr">meta</span>: &#123; <span class="hljs-attr">roles</span>: [<span class="hljs-string">&quot;admin&quot;</span>, <span class="hljs-string">&quot;user&quot;</span>] &#125;,<br>      &#125;,<br>    ],<br>  &#125;,<br>  &#123;<br>    <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;/PersonManage&quot;</span>,<br>    <span class="hljs-attr">redirect</span>: <span class="hljs-string">&quot;/Index&quot;</span>,<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;防控单位管理&quot;</span>,<br>    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">import</span>(<span class="hljs-string">&quot;../views/SystemIndex.vue&quot;</span>),<br>    <span class="hljs-attr">meta</span>: &#123; <span class="hljs-attr">icon</span>: <span class="hljs-string">&quot;Unit&quot;</span>, <span class="hljs-attr">roles</span>: [<span class="hljs-string">&quot;admin&quot;</span>] &#125;,<br>    <span class="hljs-attr">children</span>: [<br>      &#123;<br>        <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;/addManageRecord&quot;</span>,<br>        <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;添加管理信息&quot;</span>,<br>        <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">import</span>(<span class="hljs-string">&quot;../views/AddManageRecord.vue&quot;</span>),<br>        <span class="hljs-attr">meta</span>: &#123; <span class="hljs-attr">roles</span>: [<span class="hljs-string">&quot;admin&quot;</span>] &#125;,<br>      &#125;,<br>        <span class="hljs-comment">// ....</span><br></code></pre></td></tr></table></figure>

<p>在store&#x2F;permission.js里编写动态生产路由的action</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123; asyncRoutes, constantRoutes &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/router&#x27;</span><br><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Use meta.role to determine if the current user has permission</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> <span class="hljs-variable">roles</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> <span class="hljs-variable">route</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">hasPermission</span>(<span class="hljs-params">roles, route</span>) &#123;<br>  <span class="hljs-keyword">if</span> (route.<span class="hljs-property">meta</span> &amp;&amp; route.<span class="hljs-property">meta</span>.<span class="hljs-property">roles</span>) &#123;<br>    <span class="hljs-keyword">return</span> roles.<span class="hljs-title function_">some</span>(<span class="hljs-function"><span class="hljs-params">role</span> =&gt;</span> route.<span class="hljs-property">meta</span>.<span class="hljs-property">roles</span>.<span class="hljs-title function_">includes</span>(role))<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span><br>  &#125;<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Filter asynchronous routing tables by recursion</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> routes asyncRoutes</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> <span class="hljs-variable">roles</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">filterAsyncRoutes</span>(<span class="hljs-params">routes, roles</span>) &#123;<br>  <span class="hljs-keyword">const</span> res = []<br><br>  routes.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">route</span> =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> tmp = &#123; ...route &#125;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">hasPermission</span>(roles, tmp)) &#123;<br>      <span class="hljs-keyword">if</span> (tmp.<span class="hljs-property">children</span>) &#123;<br>        tmp.<span class="hljs-property">children</span> = <span class="hljs-title function_">filterAsyncRoutes</span>(tmp.<span class="hljs-property">children</span>, roles)<br>      &#125;<br>      res.<span class="hljs-title function_">push</span>(tmp)<br>    &#125;<br>  &#125;)<br><br>  <span class="hljs-keyword">return</span> res<br>&#125;<br><br><span class="hljs-keyword">const</span> state = &#123;<br>  <span class="hljs-attr">routes</span>: [],<br>  <span class="hljs-attr">addRoutes</span>: []<br>&#125;<br><br><span class="hljs-keyword">const</span> mutations = &#123;<br>  <span class="hljs-attr">SET_ROUTES</span>: <span class="hljs-function">(<span class="hljs-params">state, routes</span>) =&gt;</span> &#123;<br>    state.<span class="hljs-property">addRoutes</span> = routes<br>    state.<span class="hljs-property">routes</span> = constantRoutes.<span class="hljs-title function_">concat</span>(routes)<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">const</span> actions = &#123;<br>  <span class="hljs-title function_">generateRoutes</span>(<span class="hljs-params">&#123; commit &#125;, roles</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> &#123;<br>      <span class="hljs-keyword">let</span> accessedRoutes<br>      <span class="hljs-keyword">if</span> (roles.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;admin&#x27;</span>)) &#123;<br>        accessedRoutes = asyncRoutes || []<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        accessedRoutes = <span class="hljs-title function_">filterAsyncRoutes</span>(asyncRoutes, roles)<br>      &#125;<br>      <span class="hljs-title function_">commit</span>(<span class="hljs-string">&#x27;SET_ROUTES&#x27;</span>, accessedRoutes)<br>      <span class="hljs-title function_">resolve</span>(accessedRoutes)<br>    &#125;)<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;<br>  <span class="hljs-attr">namespaced</span>: <span class="hljs-literal">true</span>,<br>  state,<br>  mutations,<br>  actions<br>&#125;<br></code></pre></td></tr></table></figure>

<p>最后来到beforeEach的完整代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs js">router.<span class="hljs-title function_">beforeEach</span>(<span class="hljs-keyword">async</span> (to, <span class="hljs-keyword">from</span>, next) =&gt; &#123;<br>  <span class="hljs-comment">// start progress bar</span><br>  <span class="hljs-title class_">NProgress</span>.<span class="hljs-title function_">start</span>();<br><br>  <span class="hljs-comment">// set page title</span><br>  <span class="hljs-variable language_">document</span>.<span class="hljs-property">title</span> = <span class="hljs-string">`<span class="hljs-subst">$&#123;to.name&#125;</span> - 疫情防控系统`</span>;<br><br>  <span class="hljs-comment">// determine whether the user has logged in</span><br>  <span class="hljs-keyword">const</span> hasToken = <span class="hljs-title function_">getToken</span>();<br><br>  <span class="hljs-keyword">if</span> (hasToken) &#123;<br>    <span class="hljs-keyword">if</span> (to.<span class="hljs-property">path</span> == <span class="hljs-string">&quot;/&quot;</span>) &#123;<br>      <span class="hljs-title function_">next</span>(<span class="hljs-string">&quot;/Index&quot;</span>);<br>      <span class="hljs-title class_">NProgress</span>.<span class="hljs-title function_">done</span>();<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-comment">// determine whether the user has obtained his permission roles through getInfo</span><br>      <span class="hljs-keyword">const</span> hasRoles = store.<span class="hljs-property">getters</span>.<span class="hljs-property">roles</span> &amp;&amp; store.<span class="hljs-property">getters</span>.<span class="hljs-property">roles</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>;<br><br>      <span class="hljs-keyword">if</span> (hasRoles) &#123;<br>        <span class="hljs-title function_">next</span>();<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>          <span class="hljs-comment">// get user info</span><br>          <span class="hljs-comment">// note: roles must be a object array! such as: [&#x27;admin&#x27;] or ,[&#x27;developer&#x27;,&#x27;editor&#x27;]</span><br>          <span class="hljs-keyword">const</span> &#123; roles &#125; = <span class="hljs-keyword">await</span> store.<span class="hljs-title function_">dispatch</span>(<span class="hljs-string">&quot;user/getInfo&quot;</span>);<br><br>          <span class="hljs-comment">// generate accessible routes map based on roles</span><br>          <span class="hljs-keyword">const</span> accessRoutes = <span class="hljs-keyword">await</span> store.<span class="hljs-title function_">dispatch</span>(<br>            <span class="hljs-string">&quot;permission/generateRoutes&quot;</span>,<br>            roles<br>          );<br><br>          accessRoutes.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">singleRoute</span>) =&gt;</span> &#123;<br>            router.<span class="hljs-title function_">addRoute</span>(singleRoute);<br>          &#125;);<br><br>          <span class="hljs-comment">// 由于Index里通过router.options.routes渲染侧边栏</span><br>          <span class="hljs-comment">// 加之其无法通过addRoutes动态渲染</span><br>          <span class="hljs-comment">// 故此处需手动添加，慎之慎之！</span><br>          router.<span class="hljs-property">options</span>.<span class="hljs-property">routes</span> = store.<span class="hljs-property">getters</span>.<span class="hljs-property">permission_routes</span>;<br><br>          <span class="hljs-comment">// dynamically add accessible routes</span><br>          <span class="hljs-comment">// hack method to ensure that addRoutes is complete</span><br>          <span class="hljs-comment">// set the replace: true, so the navigation will not leave a history record</span><br>          <span class="hljs-title function_">next</span>(&#123; ...to, <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span> &#125;);<br>        &#125; <span class="hljs-keyword">catch</span> (error) &#123;<br>          <span class="hljs-comment">// remove token and go to login page to re-login</span><br>          <span class="hljs-keyword">await</span> store.<span class="hljs-title function_">dispatch</span>(<span class="hljs-string">&quot;user/resetToken&quot;</span>);<br>          <span class="hljs-title class_">Message</span>.<span class="hljs-title function_">error</span>(error || <span class="hljs-string">&quot;Has Error&quot;</span>);<br>          <span class="hljs-title function_">next</span>(<span class="hljs-string">`/?redirect=<span class="hljs-subst">$&#123;to.path&#125;</span>`</span>);<br>          <span class="hljs-title class_">NProgress</span>.<span class="hljs-title function_">done</span>();<br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">if</span> (whiteList.<span class="hljs-title function_">indexOf</span>(to.<span class="hljs-property">path</span>) !== -<span class="hljs-number">1</span>) &#123;<br>      <span class="hljs-comment">// in the free login whitelist, go directly</span><br>      <span class="hljs-title function_">next</span>();<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-comment">// other pages that do not have permission to access are redirected to the login page.</span><br>      <span class="hljs-title class_">Message</span>(&#123;<br>        <span class="hljs-attr">message</span>: <span class="hljs-string">&quot;请先登录！&quot;</span>,<br>        <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;warning&quot;</span>,<br>      &#125;);<br>      <span class="hljs-title function_">next</span>(<span class="hljs-string">`/?redirect=<span class="hljs-subst">$&#123;to.path&#125;</span>`</span>);<br>      <span class="hljs-title class_">NProgress</span>.<span class="hljs-title function_">done</span>();<br>    &#125;<br>  &#125;<br>&#125;);<br></code></pre></td></tr></table></figure>

<p>这里的<code>router.options.routes = store.getters.permission_routes;</code>debug了很久，最后看到，不管是vue-admin还是vue-router的github issues，其实早就提到了这个问题（所以，一定要多用谷歌）</p>
<p><a target="_blank" rel="noopener" href="https://github.com/PanJiaChen/vue-element-admin/issues/2370">https://github.com/PanJiaChen/vue-element-admin/issues/2370</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/vuejs/vue-router/issues/1859">https://github.com/vuejs/vue-router/issues/1859</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/rzsyztd/p/14134565.html">https://www.cnblogs.com/rzsyztd/p/14134565.html</a></p>
<p>我们的Index里用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-title function_">created</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">router</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">$router</span>.<span class="hljs-property">options</span>.<span class="hljs-property">routes</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">i</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">return</span> i.<span class="hljs-property">meta</span>;<br>  &#125;);<br></code></pre></td></tr></table></figure>

<p>生成router</p>
<p>但这个生成后不会动态更改，因此我们还是先把生成的路由放在vuex里，再赋值给this.$router.options</p>
<h1 id="SvgIcon"><a href="#SvgIcon" class="headerlink" title="SvgIcon"></a>SvgIcon</h1><p>网上SvgIcon的封装教程很多，我参考的是这两篇</p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903517564436493">https://juejin.cn/post/6844903517564436493</a></p>
<p><a target="_blank" rel="noopener" href="https://kalacloud.com/blog/using-svg-and-vue-complete-guide/">https://kalacloud.com/blog/using-svg-and-vue-complete-guide/</a></p>
<p>（这卡拉云广告多，但是优质教程也很多hh）</p>
<p>vue.config.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-title function_">defineConfig</span>(&#123;<br>  <span class="hljs-comment">// svg</span><br>  <span class="hljs-title function_">chainWebpack</span>(<span class="hljs-params">config</span>) &#123;<br>    config.<span class="hljs-property">module</span>.<span class="hljs-title function_">rule</span>(<span class="hljs-string">&quot;svg&quot;</span>).<span class="hljs-property">exclude</span>.<span class="hljs-title function_">add</span>(<span class="hljs-title function_">resolve</span>(<span class="hljs-string">&quot;src/icons&quot;</span>)).<span class="hljs-title function_">end</span>();<br>    config.<span class="hljs-property">module</span><br>      .<span class="hljs-title function_">rule</span>(<span class="hljs-string">&quot;icons&quot;</span>)<br>      .<span class="hljs-title function_">test</span>(<span class="hljs-regexp">/\.svg$/</span>)<br>      .<span class="hljs-property">include</span>.<span class="hljs-title function_">add</span>(<span class="hljs-title function_">resolve</span>(<span class="hljs-string">&quot;src/icons&quot;</span>))<br>      .<span class="hljs-title function_">end</span>()<br>      .<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;svg-sprite-loader&quot;</span>)<br>      .<span class="hljs-title function_">loader</span>(<span class="hljs-string">&quot;svg-sprite-loader&quot;</span>)<br>      .<span class="hljs-title function_">options</span>(&#123;<br>        <span class="hljs-attr">symbolId</span>: <span class="hljs-string">&quot;icon-[name]&quot;</span>,<br>      &#125;)<br>      .<span class="hljs-title function_">end</span>();<br>  &#125;,<br>&#125;)<br></code></pre></td></tr></table></figure>

<p>components&#x2F;SvgIcon.vue</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;template&gt;<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">svg</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;svg-icon&quot;</span> <span class="hljs-attr">aria-hidden</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">use</span> <span class="hljs-attr">:xlink:href</span>=<span class="hljs-string">&quot;iconName&quot;</span> /&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">svg</span>&gt;</span></span><br>&lt;/template&gt;<br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="language-css"><span class="language-xml">  <span class="hljs-selector-class">.svg-icon</span> &#123;</span></span><br><span class="language-css"><span class="language-xml">    <span class="hljs-attribute">width</span>: <span class="hljs-number">1.5em</span>;</span></span><br><span class="language-css"><span class="language-xml">    <span class="hljs-attribute">height</span>: <span class="hljs-number">1.5em</span>;</span></span><br><span class="language-css"><span class="language-xml">  &#125;</span></span><br><span class="language-css"><span class="language-xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></span><br><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="language-javascript"><span class="language-xml">  <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;</span></span><br><span class="language-javascript"><span class="language-xml">    <span class="hljs-attr">props</span>: &#123;</span></span><br><span class="language-javascript"><span class="language-xml">      <span class="hljs-attr">iconClass</span>: &#123;</span></span><br><span class="language-javascript"><span class="language-xml">        <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>,</span></span><br><span class="language-javascript"><span class="language-xml">        <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>,</span></span><br><span class="language-javascript"><span class="language-xml">      &#125;,</span></span><br><span class="language-javascript"><span class="language-xml">    &#125;,</span></span><br><span class="language-javascript"><span class="language-xml">    <span class="hljs-attr">computed</span>: &#123;</span></span><br><span class="language-javascript"><span class="language-xml">      <span class="hljs-title function_">iconName</span>(<span class="hljs-params"></span>) &#123;</span></span><br><span class="language-javascript"><span class="language-xml">        <span class="hljs-keyword">return</span> <span class="hljs-string">`#icon-<span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.iconClass&#125;</span>`</span>;</span></span><br><span class="language-javascript"><span class="language-xml">      &#125;,</span></span><br><span class="language-javascript"><span class="language-xml">    &#125;,</span></span><br><span class="language-javascript"><span class="language-xml">  &#125;;</span></span><br><span class="language-javascript"><span class="language-xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br></code></pre></td></tr></table></figure>

<p>icons&#x2F;index.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">SvgIcon</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/components/SvgIcon&quot;</span>;<br><span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">component</span>(<span class="hljs-string">&quot;svg-icon&quot;</span>, <span class="hljs-title class_">SvgIcon</span>);<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * &#x27;./svg&#x27; 代表要查找的文件路径</span><br><span class="hljs-comment"> * false 代表是否查找子目录</span><br><span class="hljs-comment"> * /\.svg$/ 代表要匹配文件的正则</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> svg = <span class="hljs-built_in">require</span>.<span class="hljs-title function_">context</span>(<span class="hljs-string">&quot;./svg&quot;</span>, <span class="hljs-literal">false</span>, <span class="hljs-regexp">/\.svg$/</span>);<br><span class="hljs-keyword">const</span> <span class="hljs-title function_">requireAll</span> = (<span class="hljs-params">requireContext</span>) =&gt;<br>  requireContext.<span class="hljs-title function_">keys</span>().<span class="hljs-title function_">map</span>(requireContext);<br>requireAll(svg);<br></code></pre></td></tr></table></figure>

<p>main.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;./icons&quot;</span>;<br></code></pre></td></tr></table></figure>

<p>接着可以去iconfont等网站下载svg，放在icons&#x2F;svg文件夹里即可</p>
<p>在各处都可直接引入</p>
<p><code>&lt;svg-icon : icon-class =&quot;this.isCollapse ? &#39;Collapse&#39; : &#39;Expand&#39;&quot; @click.native.prevent=&quot;changeCollapse&quot; /&gt;</code></p>
<p>我们更是在router的meta里加了icon属性，在systemindex里v-for套娃</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;el-menu<br>  router<br>  :<span class="hljs-keyword">default</span>-active=<span class="hljs-string">&quot;$route.path&quot;</span><br>  :collapse=<span class="hljs-string">&quot;isCollapse&quot;</span><br>  <span class="hljs-keyword">class</span>=<span class="hljs-string">&quot;el-menu-vertical&quot;</span><br>&gt;<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">el-submenu</span></span></span><br><span class="hljs-tag"><span class="language-xml">    <span class="hljs-attr">v-for</span>=<span class="hljs-string">&quot;(item, index) in router&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">    <span class="hljs-attr">:index</span>=<span class="hljs-string">&quot;index + &#x27;&#x27;&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">    <span class="hljs-attr">:key</span>=<span class="hljs-string">&quot;index&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">  &gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">slot</span>=<span class="hljs-string">&quot;title&quot;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">align</span>=<span class="hljs-string">&quot;left&quot;</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">svg-icon</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">v-if</span>=<span class="hljs-string">&quot;item.meta &amp;&amp; item.meta.icon&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">:icon-class</span>=<span class="hljs-string">&quot;item.meta &amp;&amp; item.meta.icon&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;margin-right: 10px&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">svg-icon</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;font-weight: bold&quot;</span>&gt;</span>&#123;&#123; item.name &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">el-menu-item-group</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">el-menu-item</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">v-for</span>=<span class="hljs-string">&quot;(item2, index2) in item.children&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">:index</span>=<span class="hljs-string">&quot;item2.path&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">:key</span>=<span class="hljs-string">&quot;index2&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      &gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">svg-icon</span></span></span><br><span class="hljs-tag"><span class="language-xml">            <span class="hljs-attr">v-if</span>=<span class="hljs-string">&quot;item2.meta &amp;&amp; item2.meta.icon&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">            <span class="hljs-attr">:icon-class</span>=<span class="hljs-string">&quot;item2.meta &amp;&amp; item2.meta.icon&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">          &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">svg-icon</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;font-size: small; float: left&quot;</span>&gt;</span>&#123;&#123;</span><br><span class="language-xml">            item2.name</span><br><span class="language-xml">          &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">el-menu-item</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">el-menu-item-group</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">el-submenu</span>&gt;</span></span><br>&lt;/el-menu&gt;<br></code></pre></td></tr></table></figure>

<p>我还是要讲一下遇到最大的一次版本不统一的坑</p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/7098899448335450126">https://juejin.cn/post/7098899448335450126</a></p>
<p>一直报错Error: Cannot find module ‘webpack&#x2F;lib&#x2F;RuleSet’，查了半天也查不出来</p>
<p>最后发现自己的svg-sprite-loader还是4.3.x版本，安装到5.2.1以上就解决了bug</p>
<p>痛苦，差点nodejs都重装了</p>
<h1 id="导航美化"><a href="#导航美化" class="headerlink" title="导航美化"></a>导航美化</h1><h2 id="面包屑"><a href="#面包屑" class="headerlink" title="面包屑"></a>面包屑</h2><p>我们的路由默认都是两级，因此不必像vue-admin一样还加一层无线递归创建的逻辑，直接手写解决即可</p>
<p>SystemIndex</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;el-menu<br>  router<br>  :<span class="hljs-keyword">default</span>-active=<span class="hljs-string">&quot;$route.path&quot;</span><br>  :collapse=<span class="hljs-string">&quot;isCollapse&quot;</span><br>  <span class="hljs-keyword">class</span>=<span class="hljs-string">&quot;el-menu-vertical&quot;</span><br>&gt;<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">el-submenu</span></span></span><br><span class="hljs-tag"><span class="language-xml">    <span class="hljs-attr">v-for</span>=<span class="hljs-string">&quot;(item, index) in router&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">    <span class="hljs-attr">:index</span>=<span class="hljs-string">&quot;index + &#x27;&#x27;&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">    <span class="hljs-attr">:key</span>=<span class="hljs-string">&quot;index&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">  &gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">slot</span>=<span class="hljs-string">&quot;title&quot;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">align</span>=<span class="hljs-string">&quot;left&quot;</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">svg-icon</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">v-if</span>=<span class="hljs-string">&quot;item.meta &amp;&amp; item.meta.icon&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">:icon-class</span>=<span class="hljs-string">&quot;item.meta &amp;&amp; item.meta.icon&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;margin-right: 10px&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">svg-icon</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;font-weight: bold&quot;</span>&gt;</span>&#123;&#123; item.name &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">el-menu-item-group</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">el-menu-item</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">v-for</span>=<span class="hljs-string">&quot;(item2, index2) in item.children&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">:index</span>=<span class="hljs-string">&quot;item2.path&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">:key</span>=<span class="hljs-string">&quot;index2&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      &gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">svg-icon</span></span></span><br><span class="hljs-tag"><span class="language-xml">            <span class="hljs-attr">v-if</span>=<span class="hljs-string">&quot;item2.meta &amp;&amp; item2.meta.icon&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">            <span class="hljs-attr">:icon-class</span>=<span class="hljs-string">&quot;item2.meta &amp;&amp; item2.meta.icon&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">          &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">svg-icon</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;font-size: small; float: left&quot;</span>&gt;</span>&#123;&#123;</span><br><span class="language-xml">            item2.name</span><br><span class="language-xml">          &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">el-menu-item</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">el-menu-item-group</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">el-submenu</span>&gt;</span></span><br>&lt;/el-menu&gt;<br></code></pre></td></tr></table></figure>

<h2 id="可折叠"><a href="#可折叠" class="headerlink" title="可折叠"></a>可折叠</h2><p>这里用到了子组件向父组件传递信息的方法</p>
<p>首先在父组件SystemIndex中向子组件传递props，也就是changeMenu方法（改变导航栏的伸缩情况</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;<span class="hljs-title class_">NavBar</span> @changeMenu=<span class="hljs-string">&quot;changeMenu&quot;</span>&gt;&lt;/<span class="hljs-title class_">NavBar</span>&gt;<br></code></pre></td></tr></table></figure>

<p>在子组件NavBar中，在icon里设置点击触发</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;svg-icon :icon-<span class="hljs-keyword">class</span>=<span class="hljs-string">&quot;this.isCollapse ? &#x27;Collapse&#x27; : &#x27;Expand&#x27;&quot;</span> @click.<span class="hljs-property">native</span>.<span class="hljs-property">prevent</span>=<span class="hljs-string">&quot;changeCollapse&quot;</span> /&gt;<br></code></pre></td></tr></table></figure>

<p>触发后，在对应method中向父组件发送（emit）信号，父组件将会执行对应函数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-attr">methods</span>: &#123;<br>  <span class="hljs-title function_">changeCollapse</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">isCollapse</span> = !<span class="hljs-variable language_">this</span>.<span class="hljs-property">isCollapse</span>;<br>    <span class="hljs-variable language_">this</span>.$emit(<span class="hljs-string">&quot;changeMenu&quot;</span>);<br>  &#125;,<br>&#125;,<br></code></pre></td></tr></table></figure>

<h1 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h1><p>在开发的时候，针对不同的处理方式，设置了不同的环境变量，例如run serve时用mock的api，build再用真实的后端</p>
<p><img src="https://baokker-oss-blog-hangzhou.oss-cn-hangzhou.aliyuncs.com/cdn_for_blog/blog_imgs/image-20220905133907315.png" srcset="/img/loading.gif" lazyload alt="image-20220905133907315"></p>
<p><img src="https://baokker-oss-blog-hangzhou.oss-cn-hangzhou.aliyuncs.com/cdn_for_blog/blog_imgs/image-20220905133925664.png" srcset="/img/loading.gif" lazyload alt="image-20220905133925664"></p>
<p>但是要注意，开头一定要带有VUE_APP</p>
<blockquote>
<p>请注意，只有 <code>NODE_ENV</code>，<code>BASE_URL</code> 和以 <code>VUE_APP_</code> 开头的变量将通过 <code>webpack.DefinePlugin</code> 静态地嵌入到<em>客户端侧</em>的代码中。这是为了避免意外公开机器上可能具有相同名称的私钥。</p>
</blockquote>
<p>相关教程：<a target="_blank" rel="noopener" href="https://cli.vuejs.org/zh/guide/mode-and-env.html">https://cli.vuejs.org/zh/guide/mode-and-env.html</a></p>
<p>9.10更新：学weblab的时候了解到，这些变量其实是不宜放在开源项目中的，最好还是加入到gitignore中，毕竟我们后来赶ddl，赶着赶着就把后端服务器的ip传上去了~</p>
<h1 id="调试"><a href="#调试" class="headerlink" title="调试"></a>调试</h1><p>Vue Devtools，可以去查看一下，会爬梯子就很容易安装</p>
<p><img src="https://baokker-oss-blog-hangzhou.oss-cn-hangzhou.aliyuncs.com/cdn_for_blog/blog_imgs/image-20220905103806266.png" srcset="/img/loading.gif" lazyload alt="image-20220905103806266"></p>
<h1 id="语法检查"><a href="#语法检查" class="headerlink" title="语法检查"></a>语法检查</h1><p>之前因为嫌babel的语法检查（它总是建议Component统一用multi word的方式命名，但是404页面真的需要multiword吗？我不懂），因此把它关掉了。后来想想，前端代码繁杂，要求严格一些也并非一些坏事，还可以de掉一些不必要的bug，于是又将其开启</p>
<p>vue.config.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-title function_">defineConfig</span>(&#123;<br>  <span class="hljs-attr">transpileDependencies</span>: <span class="hljs-literal">true</span>,<br>  <span class="hljs-comment">// unset multiword check</span><br>  <span class="hljs-attr">lintOnSave</span>:<span class="hljs-literal">true</span>,<br>&#125;)<br></code></pre></td></tr></table></figure>

<p>又增加了.eslintrc.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-string">&quot;root&quot;</span>: <span class="hljs-literal">true</span>,<br>  <span class="hljs-string">&quot;env&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;node&quot;</span>: <span class="hljs-literal">true</span><br>  &#125;,<br>  <span class="hljs-string">&quot;extends&quot;</span>: [<br>    <span class="hljs-string">&quot;plugin:vue/essential&quot;</span>,<br>    <span class="hljs-string">&quot;eslint:recommended&quot;</span><br>  ],<br>  <span class="hljs-string">&quot;parserOptions&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;parser&quot;</span>: <span class="hljs-string">&quot;babel-eslint&quot;</span><br>  &#125;,<br>  <span class="hljs-attr">rules</span>: &#123;<br>    <span class="hljs-string">&quot;vue/multi-word-component-names&quot;</span>: [<br>      <span class="hljs-string">&quot;error&quot;</span>,<br>      &#123;<br>        <span class="hljs-attr">ignores</span>: [<span class="hljs-string">&quot;404&quot;</span>,<span class="hljs-string">&#x27;Verify&#x27;</span>,<span class="hljs-string">&quot;News&quot;</span>,<span class="hljs-string">&quot;Header&quot;</span>,<span class="hljs-string">&quot;Home&quot;</span>],<br>      &#125;,<br>    ],<br>  &#125;,<br>&#125;;<br></code></pre></td></tr></table></figure>

<p>在rules里加入ignores，就不会再对这个vue文件的命名报错</p>
<p>加上后果然发现了不少问题，de完后感觉代码整洁了不少</p>
<h1 id="部署发布"><a href="#部署发布" class="headerlink" title="部署发布"></a>部署发布</h1><p>最主要参考了medium上的<a target="_blank" rel="noopener" href="https://thucnc.medium.com/deploy-a-vuejs-web-app-with-nginx-on-ubuntu-18-04-f93860219030">这篇</a>和vue-admin的打包发布<a target="_blank" rel="noopener" href="https://panjiachen.github.io/vue-element-admin-site/zh/guide/essentials/deploy.html">教程</a></p>
<p>我在我的服务器上部署了网站（还崩了两回，可能还是我腾讯云买的配置太差了呜呜）</p>
<p>系统是Ubuntu20.04</p>
<p>首先安装nginx</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo apt-get install nginx<br></code></pre></td></tr></table></figure>

<p>然后假定我的项目名为covid，做如下处理</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo touch /etc/nginx/sites-available/covid<br>sudo ln -s /etc/nginx/sites-available/covid /etc/nginx/sites-enabled/covid<br>sudo vim /etc/nginx/sites-available/covid<br></code></pre></td></tr></table></figure>

<p>这里注意，ln一定要用绝对路径，不然会死循环，不要问我为什么知道的</p>
<p>接下来修改这个covid文件</p>
<p>server_name localhost; 可以改成对应的域名</p>
<p>try_files $uri $uri&#x2F; &#x2F;index.html;是针对router是history的mode的情况下写的，因为此模式下nginx无法直接找到对应的页面</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs text">server &#123;<br>    listen      9020;<br>    server_name localhost;<br>    charset utf-8;<br>    root    /covid/dist;<br>    index   index.html index.htm;<br>    # Always serve index.html for any request<br>    location / &#123;<br>        root /covid/dist/;<br>        try_files $uri $uri/ /index.html;<br>        index index.html;<br>    &#125;<br>    error_log  /var/log/nginx/vue-app-error.log;<br>    access_log /var/log/nginx/vue-app-access.log;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>接下来，在写好的前端代码文件夹中运行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">npm run build<br></code></pre></td></tr></table></figure>

<p>将生成的dist文件夹复制到服务器的&#x2F;covid&#x2F;dist位置（注意是根目录），也就是对应的root位置</p>
<p>接着启动nginx</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo nginx -t # 检查语法<br>sudo service nginx restart # 重启nginx<br></code></pre></td></tr></table></figure>

<h1 id="一些细节"><a href="#一些细节" class="headerlink" title="一些细节"></a>一些细节</h1><h2 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h2><p>.then()还有.catch()都是什么？为什么会用到这些东西？这些其实就是Promise的快速写法</p>
<p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Using_promises">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Using_promises</a></p>
<p>对一个异步函数，分别定义两个回调函数resolve和reject，表示成功运行和抛出异常时的不同操作</p>
<h2 id="css-scss"><a href="#css-scss" class="headerlink" title="css scss"></a>css scss</h2><p>transition的动画效果很有意思，可以去学一下</p>
<p><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000041923259">https://segmentfault.com/a/1190000041923259</a></p>
<p>flex布局比传统的align和float布局方法更高级（也复杂得多），但效果确实好，建议去学学</p>
<p>scss是css的超集，提供了更多的功能</p>

              
            </div>
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E6%8A%80%E6%9C%AF/" class="category-chain-item">技术</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BE%E8%AE%BE/">#数据库课设</a>
      
        <a href="/tags/%E5%89%8D%E7%AB%AF/">#前端</a>
      
        <a href="/tags/vue/">#vue</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>前端漫谈——数据库课设心得记录</div>
      <div>http://baokker.github.io/2022/09/04/前端漫谈——数据库课设心得记录/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>Baokker</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2022年9月4日</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>更新于</div>
          <div>2022年10月8日</div>
        </div>
      
      <div class="license-meta-item">
        <div>许可协议</div>
        <div>
          
            
            
              <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
              <span class="hint--top hint--rounded" aria-label="BY - 署名">
                <i class="iconfont icon-by"></i>
              </span>
              </a>
            
          
        </div>
      </div>
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2022/09/06/%E4%B8%80%E9%94%AE%E8%AE%BE%E7%BD%AE%E5%8F%B3%E9%94%AE%E9%80%9A%E8%BF%87vscode%E6%89%93%E5%BC%80%E6%96%87%E4%BB%B6%E5%A4%B9/" title="一键设置右键通过vscode打开文件夹">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">一键设置右键通过vscode打开文件夹</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2022/08/29/git-pull%E6%8B%89%E5%8F%96%E8%BF%9C%E7%AB%AF%E4%BB%A3%E7%A0%81%E4%B8%8E%E6%9C%AC%E5%9C%B0%E5%86%B2%E7%AA%81%E9%97%AE%E9%A2%98/" title="git pull拉取远端代码与本地冲突问题">
                        <span class="hidden-mobile">git pull拉取远端代码与本地冲突问题</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  <article id="comments" lazyload>
    
  <div id="waline"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#waline', function() {
      Fluid.utils.createCssLink('https://lib.baomitu.com/waline/2.3.2/waline.min.css')
      Fluid.utils.createScript('https://lib.baomitu.com/waline/2.3.2/waline.min.js', function() {
        var options = Object.assign(
          {"serverURL":"https://blog-comment-server-j7p2mwkga-baokker.vercel.app/","path":"window.location.pathname","meta":["nick","mail","link"],"requiredMeta":["nick"],"lang":"zh-CN","emoji":["https://cdn.jsdelivr.net/gh/walinejs/emojis/weibo"],"dark":"html[data-user-color-scheme=\"dark\"]","wordLimit":0,"pageSize":10},
          {
            el: '#waline',
            path: window.location.pathname
          }
        )
        Waline.init(options);
        Fluid.utils.waitElementVisible('#waline .vcontent', () => {
          var imgSelector = '#waline .vcontent img:not(.vemoji)';
          Fluid.plugins.imageCaption(imgSelector);
          Fluid.plugins.fancyBox(imgSelector);
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


  </article>


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  






    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>






  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.0/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      headingSelector : CONFIG.toc.headingSelector || 'h1,h2,h3,h4,h5,h6',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      collapseDepth   : CONFIG.toc.collapseDepth || 0,
      scrollSmooth    : true,
      headingsOffset  : -boardTop
    });
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }
  });
</script>


  <script>
  (function() {
    var enableLang = CONFIG.code_language.enable && CONFIG.code_language.default;
    var enableCopy = CONFIG.copy_btn;
    if (!enableLang && !enableCopy) {
      return;
    }

    function getBgClass(ele) {
      return Fluid.utils.getBackgroundLightness(ele) >= 0 ? 'code-widget-light' : 'code-widget-dark';
    }

    var copyTmpl = '';
    copyTmpl += '<div class="code-widget">';
    copyTmpl += 'LANG';
    copyTmpl += '</div>';
    jQuery('.markdown-body pre').each(function() {
      var $pre = jQuery(this);
      if ($pre.find('code.mermaid').length > 0) {
        return;
      }
      if ($pre.find('span.line').length > 0) {
        return;
      }

      var lang = '';

      if (enableLang) {
        lang = CONFIG.code_language.default;
        if ($pre[0].children.length > 0 && $pre[0].children[0].classList.length >= 2 && $pre.children().hasClass('hljs')) {
          lang = $pre[0].children[0].classList[1];
        } else if ($pre[0].getAttribute('data-language')) {
          lang = $pre[0].getAttribute('data-language');
        } else if ($pre.parent().hasClass('sourceCode') && $pre[0].children.length > 0 && $pre[0].children[0].classList.length >= 2) {
          lang = $pre[0].children[0].classList[1];
          $pre.parent().addClass('code-wrapper');
        } else if ($pre.parent().hasClass('markdown-body') && $pre[0].classList.length === 0) {
          $pre.wrap('<div class="code-wrapper"></div>');
        }
        lang = lang.toUpperCase().replace('NONE', CONFIG.code_language.default);
      }
      $pre.append(copyTmpl.replace('LANG', lang).replace('code-widget">',
        getBgClass($pre[0]) + (enableCopy ? ' code-widget copy-btn" data-clipboard-snippet><i class="iconfont icon-copy"></i>' : ' code-widget">')));

      if (enableCopy) {
        Fluid.utils.createScript('https://lib.baomitu.com/clipboard.js/2.0.10/clipboard.min.js', function() {
          var clipboard = new window.ClipboardJS('.copy-btn', {
            target: function(trigger) {
              var nodes = trigger.parentNode.childNodes;
              for (var i = 0; i < nodes.length; i++) {
                if (nodes[i].tagName === 'CODE') {
                  return nodes[i];
                }
              }
            }
          });
          clipboard.on('success', function(e) {
            e.clearSelection();
            e.trigger.innerHTML = e.trigger.innerHTML.replace('icon-copy', 'icon-success');
            setTimeout(function() {
              e.trigger.innerHTML = e.trigger.innerHTML.replace('icon-success', 'icon-copy');
            }, 2000);
          });
        });
      }
    });
  })();
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
